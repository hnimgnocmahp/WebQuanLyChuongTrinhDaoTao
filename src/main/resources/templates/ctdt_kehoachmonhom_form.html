<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Thêm/Sửa Kế hoạch môn nhóm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-4">
      <h2 th:text="${item.id} == null ? 'Thêm mới' : 'Chỉnh sửa'">
        Thêm/Sửa Kế hoạch môn nhóm
      </h2>
      <form
        th:action="@{/ctdt_kehoachmonhom/save}"
        th:object="${item}"
        method="post"
      >
        <input type="hidden" th:field="*{maNhom}" />
        <div class="mb-3">
          <label class="form-label">Học phần</label>
          <select th:field="*{hocPhanId}" class="form-control" required>
            <option value="">-- Chọn --</option>
            <option
              th:each="hp : ${listHocphan}"
              th:value="${hp.id}"
              th:text="${hp.tenHp} + ' (' + ${hp.maHp} + ')'"
            ></option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Năm học</label>
          <input
            type="text"
            th:field="*{namHoc}"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Học kỳ</label>
          <input
            type="number"
            th:field="*{hocKy}"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Số lượng SV</label>
          <input
            type="number"
            th:field="*{soLuongSv}"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Thời gian bắt đầu</label>
          <input
            type="date"
            th:field="*{thoiGianBatDau}"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Thời gian kết thúc</label>
          <input
            type="date"
            th:field="*{thoiGianKetThuc}"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Trạng thái</label>
          <select th:field="*{trangThai}" class="form-control" required>
            <option value="">-- Chọn --</option>
            <option
              th:each="st : ${statusList}"
              th:value="${st}"
              th:text="${st}"
            ></option>
          </select>
        </div>
        <button type="submit" class="btn btn-success">Lưu</button>
        <a th:href="@{/ctdt_kehoachmonhom}" class="btn btn-secondary"
          >Quay lại</a
        >
      </form>
    </div>
    <script th:inline="javascript">
      function updateMaNhom() {
        var hocPhanSelect = document.querySelector("[name='hocPhanId']");
        var maNhomInput = document.querySelector("[name='maNhom']");
        var selectedOption = hocPhanSelect.options[hocPhanSelect.selectedIndex];
        var hocPhanId = hocPhanSelect.value;
        var maHp = selectedOption.text.split("(")[1];
        if (maHp) maHp = maHp.replace(")", "").trim();
        if (hocPhanId) {
          fetch("/ctdt_kehoachmonhom/countByHocPhanId/" + hocPhanId)
            .then((res) => res.json())
            .then((count) => {
              maNhomInput.value = maHp + "." + (count + 1);
            });
        } else {
          maNhomInput.value = "";
        }
      }
      document.addEventListener("DOMContentLoaded", function () {
        var hocPhanSelect = document.querySelector("[name='hocPhanId']");
        if (hocPhanSelect) {
          hocPhanSelect.addEventListener("change", updateMaNhom);
          if (hocPhanSelect.value) {
            updateMaNhom();
          }
        }
      });
    </script>
  </body>
</html>
